    <script>
    {{ with .Scratch.Get "repo_id" }}
      var base_url = '{{ (printf "%s" $.Site.BaseURL) | safeJS }}';
      var repo_id  = '{{ . | safeJS }}';
    {{ else }}
      var base_url = '';
      var repo_id  = '';
    {{ end }}
    </script>

    <script src="/js/application.js"></script>
    {{ range .Site.Params.custom_js }}
    <script src="{{ . }}"></script>
    {{ end }}

    <script>
      const offset = {{ cond (gt (len (where (readDir (relURL "content/")) ".IsDir" "ne" false)) 1) 30 105 }}
      const $ = window.jQuery;
      $(document).ready(() => {
        $('#side-navigation').stick_in_parent({
          offset_top: offset,
        });
        $('#drawerMenu a.node-toggle').click(() => {
          setTimeout(() => {
            $('#side-navigation').trigger('sticky_kit:recalc');
          }, 300);
        });
      });
    </script>

    <script>
      {{ "/* Add permanent link next to the headers */" | safeJS }}
      var headers = document.querySelector('.article:not(#feedback)').querySelectorAll("h1, h2, h3, h4, h5, h6");

      for(let i = 0; i < headers.length; i++) {
        let cnt = document.createElement("div");
        cnt.setAttribute("class", "links");
        let a = document.createElement("a");
        a.setAttribute("class", "headerlink");
        a.setAttribute("href", "#" + headers[i].id);
        a.setAttribute("title", "Permanent link")
        a.innerHTML = {{ or .Site.Params.permalink "Â¶" }};
        headers[i].appendChild(a);
        let b = document.createElement("a");
        b.setAttribute("class", "issuelink");
        b.setAttribute("title", "I found an issue")
        b.innerHTML = "!";
        cnt.appendChild(a);
        cnt.appendChild(b);
        headers[i].appendChild(cnt);
      };
  </script>
    
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      "use strict";
      
      const issuelinks = $('.article:not(#feedback) .issuelink');
      const feedback_widget = $('.feedback_widget');
      const feedback_widget_payload = $('.feedback_widget #action_payload_from');
      const feedback_widget_wrapper = $('.widget-wrapper');

      $(document).on('feedback:reset', function(e) {
        const headers = document.querySelector('.article:not(#feedback)').querySelectorAll("h1, h2, h3, h4, h5, h6");  
        $(headers).removeClass('expanded');
        issuelinks.removeClass('active');
        feedback_widget.removeClass('active active_section').css('top', '');
        feedback_widget_payload.val('footer');
        // grammarly fallback
        $("[class^=gr-top-]").remove();
      });
      
      issuelinks.on('click', function(e) {
        const self = $(this);
        const isActive = self.hasClass('active');
        const coeff = parseInt(self.parent().parent()[0].tagName.substr(1,1));
        $(document).trigger('feedback:reset');
        if(!isActive) {
          self.parent().parent().addClass('expanded');
          self.addClass('active');
          feedback_widget.addClass('active active_section').css('top', -$(feedback_widget_wrapper).offset().top + self.offset().top + 45 + 15*($(window).outerWidth()<992?0:1));
          feedback_widget_payload.val(self.parent().parent()[0].innerText.slice(0, -2));

          $(window).on('resize', function() {
            if(feedback_widget.hasClass('active_section')){
              feedback_widget.addClass('active active_section').css('top', -$(feedback_widget_wrapper).offset().top + self.offset().top + 45 + 15*($(window).outerWidth()<992?0:1));
            } else {
              $(window).off('resize', this);
            }
          });
        }
      });
    });
  
  </script>

    {{ with .Site.GoogleAnalytics }}
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', '{{ . }}', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        if (query) {
          query.addEventListener('blur', function() {
            if (this.value) {
              var path = document.location.pathname;
              ga('send', 'pageview', path + '?q=' + this.value);
            }
          });
        }
      </script>


      <script>
        window.onload = function() {
          previousPageHash = window.location.hash;
          if (previousPageHash) {
            sessionStorage.setItem('previousPageHash', previousPageHash);
            if (previousPageHash && $('.nav-tabs a').length > 0) {
              $('.nav-tabs a[href="'+ previousPageHash +'"]').tab('show');
            }
          }

        }
        
        window.onbeforeunload = function(event) {
          if (window.location.hash) {
            sessionStorage.setItem('previousPageHash', window.location.hash);
          }
        }

        $('.nav-tabs a').on('shown.bs.tab', function (e) {
            sessionStorage.setItem('previousPageHash', e.target.hash);
        });

        let previousPageHash = sessionStorage.getItem('previousPageHash');
        if (previousPageHash && $('.nav-tabs a').length > 0) {
          $('.nav-tabs a[href="'+ previousPageHash +'"]').tab('show');
        }
      </script>

    {{ end }}

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
