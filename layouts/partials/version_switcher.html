{{ $currentVersion := (.Scratch.Get "currentVersionTitle") }}
{{ if not $currentVersion}}
  {{ $context := . }}
  {{ $path := split .Dir "/" }}
  {{ if eq (index $path 0) "versions" }}
    {{ $title := (index $path 1) }}
    {{ range $index,$value := .Site.Menus }}
      {{ if eq $index $title }}
        {{ $context.Scratch.Set "currentVersionTitle" $index }}
        {{ $index }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ $currentVersion := (.Scratch.Get "currentVersionTitle") }}
{{ end }} 

<div id="version-switcher">
  <a class="current-version">
    <span>Version:</span>
    {{ if $currentVersion }}
      <h4>{{ $currentVersion }}</h4>
    {{ else }}
      <h4>Prod</h4>
    {{ end }}
  </a>
  <ul>
    <li>
      <a href="/">Latest version</a>
    </li>
    {{ range where (readDir (relURL "/content/")) ".Name" "ne" "_index.html"}}
      <li>
        <a href="{{.Name}}/">{{ .Name }} version</a>
      </li>
    {{ end }}
</div>